<div class="min-h-screen bg-gray-50">
  <!-- Header -->
  <header
    class="bg-white shadow-md sticky top-0 z-5 border-bottom-2 border-primary"
  >
    <div class="max-w-screen-xl mx-auto px-4">
      <div class="flex align-items-center justify-content-between h-4rem">
        <div class="flex align-items-center gap-3">
          <p-button
            icon="pi pi-arrow-left"
            styleClass="p-button-text p-button-rounded"
            routerLink="/home"
          >
          </p-button>

          <div class="flex align-items-center gap-2">
            <i class="pi pi-comments text-primary text-3xl"></i>
            <h1 class="text-2xl font-bold text-900 m-0">Forum</h1>
          </div>
        </div>

        <div class="flex align-items-center gap-2">
          <p-button
            label="Nuovo Post"
            icon="pi pi-plus"
            styleClass="hidden sm:inline-flex"
            (onClick)="openNewPost()"
          >
          </p-button>
          <p-button
            icon="pi pi-plus"
            styleClass="sm:hidden p-button-rounded"
            (onClick)="openNewPost()"
          >
          </p-button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Container -->
  <div class="max-w-screen-xl mx-auto px-4 py-4">
    <div class="grid">
      <!-- Sidebar Filtri -->
      <!-- <div class="col-12 lg:col-3"> -->
      <!-- <p-card styleClass="border-round-2xl shadow-1 mb-3">
          <h3 class="text-lg font-bold text-900 mb-3">Categorie</h3>
          <div class="flex flex-column gap-2">
            @for (cat of categories(); track cat.name) {
            <button
              class="p-3 border-round-xl flex align-items-center justify-content-between border-none cursor-pointer transition-all transition-duration-200"
              [class.bg-primary]="cat.active"
              [class.text-white]="cat.active"
              [class.hover:bg-gray-100]="!cat.active"
              (click)="selectCategory(cat.name)"
            >
              <span class="font-semibold">{{ cat.name }}</span>
              <p-badge
                [value]="cat.count.toString()"
                [severity]="cat.active ? 'info' : 'secondary'"
              >
              </p-badge>
            </button>
            }
          </div>
        </p-card> -->

      <!-- Tags Popolari -->
      <!-- <p-card styleClass="border-round-2xl shadow-1 hidden lg:block">
          <h3 class="text-lg font-bold text-900 mb-3">Tag Popolari</h3>
          <div class="flex flex-wrap gap-2">
            @for (tag of popularTags(); track tag) {
            <p-chip
              [label]="tag"
              styleClass="cursor-pointer hover:bg-primary-100"
              (click)="filterByTag(tag)"
            >
            </p-chip>
            }
          </div>
        </p-card> -->
      <!-- </div> -->

      <!-- Forum Posts -->
      <main class="col-12 lg:col-9">
        <!-- Toolbar -->
        <div
          class="flex align-items-center justify-content-between mb-4 flex-wrap gap-3"
        >
          <div class="flex align-items-center gap-2">
            <span class="text-600 text-sm">Ordina per:</span>
            <!-- <p-dropdown 
                  [options]="sortOptions()" 
                  [(ngModel)]="selectedSort"
                  optionLabel="label"
                  optionValue="value"
                  styleClass="w-10rem">
                </p-dropdown> -->
          </div>
          <span class="text-600 text-sm"
            >{{ forumPosts().length }} discussioni</span
          >
        </div>

        <!-- Posts List -->
        <div class="flex flex-column gap-3">
          @for (post of forumPosts(); track post.id) {
          <p-card
            styleClass="border-round-2xl shadow-1 hover:shadow-3 transition-all transition-duration-200"
          >
            <!-- Post Header -->
            <div class="flex align-items-start gap-3 mb-3">
              <p-avatar
                [label]="post.authorAvatar"
                styleClass="bg-primary"
                shape="circle"
                size="large"
              >
              </p-avatar>

              <div class="flex-1">
                <div class="flex align-items-center gap-2 mb-1 flex-wrap">
                  <span class="font-bold text-900">{{ post.author }}</span>
                  <span class="text-sm text-600">â€¢ {{ post.timeAgo }}</span>
                  @if (post.isPinned) {
                  <p-chip
                    label="Pinned"
                    icon="pi pi-bookmark-fill"
                    styleClass="bg-orange-100 text-orange-700"
                  >
                  </p-chip>
                  }
                </div>
                <p-chip
                  [label]="post.category"
                  styleClass="bg-primary-100 text-primary-700 text-xs"
                >
                </p-chip>
              </div>

              <p-button
                icon="pi pi-ellipsis-v"
                styleClass="p-button-text p-button-rounded p-button-sm"
                (onClick)="postMenu.toggle($event)"
              >
              </p-button>
              <p-menu
                #postMenu
                [model]="postMenuItems()"
                [popup]="true"
                appendTo="body"
              >
              </p-menu>
            </div>

            <!-- Post Content -->
            <h3
              class="text-xl font-bold text-900 mb-2 cursor-pointer hover:text-primary"
            >
              {{ post.title }}
            </h3>
            <p class="text-600 mb-3 line-height-3">{{ post.content }}</p>

            <!-- Tags -->
            @if (post.tags.length > 0) {
            <div class="flex flex-wrap gap-2 mb-3">
              @for (tag of post.tags; track tag) {
              <p-chip
                [label]="tag"
                styleClass="text-xs bg-gray-100 cursor-pointer"
                (click)="filterByTag(tag)"
              >
              </p-chip>
              }
            </div>
            }

            <p-divider></p-divider>

            <!-- Post Actions -->
            <div
              class="flex align-items-center justify-content-between flex-wrap gap-3"
            >
              <div class="flex align-items-center gap-4">
                <button
                  class="flex align-items-center gap-2 border-none bg-transparent cursor-pointer transition-all transition-duration-200 p-2 border-round-lg"
                  [class.text-pink-500]="post.isLiked"
                  [class.text-600]="!post.isLiked"
                  [class.hover:bg-pink-50]="post.isLiked"
                  [class.hover:bg-gray-100]="!post.isLiked"
                  (click)="toggleLike(post)"
                >
                  <i
                    [class]="
                          post.isLiked
                            ? 'pi pi-heart-fill text-xl'
                            : 'pi pi-heart text-xl'
                        "
                  ></i>
                  <span class="font-semibold">{{ post.likes }}</span>
                </button>

                <button
                  class="flex align-items-center gap-2 text-600 border-none bg-transparent cursor-pointer hover:bg-gray-100 transition-colors transition-duration-200 p-2 border-round-lg"
                  (click)="toggleComments(post)"
                >
                  <i class="pi pi-comment text-xl"></i>
                  <span class="font-semibold">{{ post.commentsCount }}</span>
                </button>

                <div class="flex align-items-center gap-2 text-600">
                  <i class="pi pi-eye text-xl"></i>
                  <span class="font-semibold">{{ post.views }}</span>
                </div>
              </div>

              <p-button
                icon="pi pi-share-alt"
                label="Condividi"
                styleClass="p-button-text p-button-sm"
              >
              </p-button>
            </div>

            <!-- Comments Section -->
            @if (post.showComments) {
            <div class="mt-4 pt-4 border-top-1 surface-border">
              <!-- New Comment Form -->
              <div class="flex gap-3 mb-4">
                <p-avatar label="TU" styleClass="bg-primary" shape="circle">
                </p-avatar>
                <div class="flex-1">
                  <textarea
                    pInputTextarea
                    [(ngModel)]="newCommentText"
                    [rows]="3"
                    placeholder="Scrivi un commento..."
                    class="w-full border-round-xl"
                  >
                  </textarea>
                  <div class="flex justify-content-end gap-2 mt-2">
                    <p-button
                      label="Annulla"
                      styleClass="p-button-text p-button-sm"
                      (onClick)="cancelComment()"
                    >
                    </p-button>
                    <p-button
                      label="Commenta"
                      icon="pi pi-send"
                      styleClass="p-button-sm"
                      (onClick)="addComment(post)"
                    >
                    </p-button>
                    <!-- <p-button 
                              label="Commenta" 
                              icon="pi pi-send"
                              styleClass="p-button-sm"
                              [disabled]="!newCommentText.trim()"
                              (onClick)="addComment(post)">
                            </p-button> -->
                  </div>
                </div>
              </div>

              <!-- Comments List -->
              @if (post.comments.length > 0) {
              <div class="flex flex-column gap-3">
                @for (comment of post.comments; track comment.id) {
                <div
                  class="flex gap-3 p-3 border-round-xl hover:bg-gray-50 transition-colors transition-duration-200"
                >
                  <p-avatar
                    [label]="comment.authorAvatar"
                    styleClass="bg-blue-500"
                    shape="circle"
                  >
                  </p-avatar>
                  <div class="flex-1">
                    <div class="flex align-items-center gap-2 mb-1">
                      <span class="font-bold text-900 text-sm"
                        >{{ comment.author }}</span
                      >
                      <span class="text-xs text-600"
                        >{{ comment.timeAgo }}</span
                      >
                    </div>
                    <p class="text-600 text-sm mb-2 line-height-3">
                      {{ comment.content }}
                    </p>
                    <div class="flex align-items-center gap-3">
                      <button
                        class="flex align-items-center gap-1 border-none bg-transparent cursor-pointer transition-colors transition-duration-200 p-1"
                        [class.text-pink-500]="comment.isLiked"
                        [class.text-600]="!comment.isLiked"
                        (click)="toggleCommentLike(comment)"
                      >
                        <i
                          [class]="
                                comment.isLiked
                                  ? 'pi pi-heart-fill'
                                  : 'pi pi-heart'
                              "
                        ></i>
                        <span class="text-xs font-semibold"
                          >{{ comment.likes }}</span
                        >
                      </button>
                      <button
                        class="text-xs text-600 border-none bg-transparent cursor-pointer hover:text-primary transition-colors transition-duration-200"
                      >
                        Rispondi
                      </button>
                    </div>
                  </div>
                </div>
                }
              </div>
              }
            </div>
            }
          </p-card>
          }
        </div>

        <!-- Load More -->
        <div class="text-center mt-4">
          <p-button
            label="Carica altri post"
            icon="pi pi-refresh"
            styleClass="p-button-outlined"
          >
          </p-button>
        </div>
      </main>
    </div>
  </div>
</div>
